<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PE Master - Complete Physical Education Platform</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 15px;
        }

        .login-container {
            max-width: 400px;
            margin: 50px auto;
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            text-align: center;
        }

        .login-header {
            margin-bottom: 30px;
        }

        .login-header h1 {
            color: #333;
            margin: 0 0 10px 0;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin-top: 10px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header-left h1 {
            color: #333;
            margin: 0 0 5px 0;
            font-size: 2em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-left p {
            color: #666;
            margin: 0;
            font-size: 0.9em;
        }

        .user-info {
            text-align: right;
            color: #333;
        }

        .user-info h3 {
            margin: 0 0 5px 0;
            color: #667eea;
        }

        .user-info p {
            margin: 0;
            font-size: 0.9em;
            color: #666;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        .main-menu {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .menu-card {
            background: white;
            border-radius: 15px;
            padding: 30px 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .menu-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .menu-card:hover::before {
            left: 100%;
        }

        .menu-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .menu-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        .menu-card h2 {
            color: #333;
            margin: 0 0 10px 0;
            font-size: 1.4em;
        }

        .menu-card p {
            color: #666;
            line-height: 1.5;
            margin: 0;
            font-size: 0.95em;
        }

        .progress-indicator {
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #28a745, #20c997);
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 25px 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section.active {
            display: block;
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            font-size: 1em;
            min-height: 50px;
        }

        .back-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .sports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .sport-card {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            padding: 25px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }

        .sport-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .sport-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
            display: block;
        }

        .quiz-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .quiz-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }

        .quiz-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .quiz-icon {
            font-size: 2.2em;
            margin-bottom: 10px;
            display: block;
        }

        .quiz-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .question {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .question h4 {
            color: #333;
            margin: 0 0 15px 0;
            font-size: 1.1em;
            line-height: 1.4;
        }

        .options {
            display: grid;
            gap: 12px;
        }

        .option {
            background: #e9ecef;
            padding: 18px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            font-size: 0.95em;
            line-height: 1.4;
            min-height: 50px;
            display: flex;
            align-items: center;
        }

        .option:hover {
            background: #dee2e6;
        }

        .option.selected {
            background: #d1ecf1;
            border-color: #17a2b8;
        }

        .option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 18px 25px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
            margin: 8px;
            min-height: 50px;
            min-width: 120px;
        }

        .btn:hover {
            background: #44a08d;
            transform: translateY(-2px);
        }

        .btn-primary {
            background: #007bff;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .score-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
        }

        .score-number {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
        }

        .lesson-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .lesson-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 120px;
        }

        .lesson-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .lesson-card.completed {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .lesson-card.in-progress {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        }

        .progress-stats {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 15px;
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .user-info {
                text-align: center;
            }
            
            .main-menu {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .sports-grid, .quiz-grid, .lesson-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .section {
                padding: 20px 15px;
            }
            
            .quiz-container {
                padding: 15px;
            }
            
            .question {
                padding: 15px;
            }
            
            .btn {
                width: 100%;
                margin: 5px 0;
            }

            .progress-stats {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 8px;
            }
            
            .login-container {
                margin: 20px auto;
                padding: 30px 20px;
            }
            
            .menu-icon, .sport-icon, .quiz-icon {
                font-size: 2.5em;
            }
            
            .option {
                padding: 15px 12px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-container">
            <div class="login-header">
                <h1>🏃‍♂️ PE Master</h1>
                <p>Student Login Portal</p>
            </div>
            
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="studentName">Full Name</label>
                    <input type="text" id="studentName" required placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                    <label for="studentId">Student ID</label>
                    <input type="text" id="studentId" required placeholder="Enter your student ID">
                </div>
                
                <div class="form-group">
                    <label for="studentClass">Class</label>
                    <select id="studentClass" required>
                        <option value="">Select your class</option>
                        <option value="Y1C">Year 1C</option>
                        <option value="Y1H">Year 1H</option>
                        <option value="Y1I">Year 1I</option>
                        <option value="Y1S">Year 1S</option>
                        <option value="Y1J">Year 1J</option>
                        <option value="Y1B">Year 1B</option>
                        <option value="Y2C">Year 2C</option>
                        <option value="Y2H">Year 2H</option>
                        <option value="Y2I">Year 2I</option>
                        <option value="Y2S">Year 2S</option>
                        <option value="Y2J">Year 2J</option>
                        <option value="Y2B">Year 2B</option>
                        <option value="Y3C">Year 3C</option>
                        <option value="Y3H">Year 3H</option>
                        <option value="Y3I">Year 3I</option>
                        <option value="Y3S">Year 3S</option>
                        <option value="Y3J">Year 3J</option>
                        <option value="Y3B">Year 3B</option>
                        <option value="Y4C">Year 4C</option>
                        <option value="Y4H">Year 4H</option>
                        <option value="Y4I">Year 4I</option>
                        <option value="Y4S">Year 4S</option>
                        <option value="Y4J">Year 4J</option>
                        <option value="Y4B">Year 4B</option>
                        <option value="Y5C">Year 5C</option>
                        <option value="Y5H">Year 5H</option>
                        <option value="Y5I">Year 5I</option>
                        <option value="Y5S">Year 5S</option>
                        <option value="Y5J">Year 5J</option>
                        <option value="Y5B">Year 5B</option>
                        <option value="Y6C">Year 6C</option>
                        <option value="Y6H">Year 6H</option>
                        <option value="Y6I">Year 6I</option>
                        <option value="Y6S">Year 6S</option>
                        <option value="Y6J">Year 6J</option>
                        <option value="Y6B">Year 6B</option>
                        <option value="Y7C">Year 7C</option>
                        <option value="Y7H">Year 7H</option>
                        <option value="Y7I">Year 7I</option>
                        <option value="Y7S">Year 7S</option>
                        <option value="Y7J">Year 7J</option>
                        <option value="Y7B">Year 7B</option>
                        <option value="Y8C">Year 8C</option>
                        <option value="Y8H">Year 8H</option>
                        <option value="Y8I">Year 8I</option>
                        <option value="Y8S">Year 8S</option>
                        <option value="Y8J">Year 8J</option>
                        <option value="Y8B">Year 8B</option>
                        <option value="Y9C">Year 9C</option>
                        <option value="Y9H">Year 9H</option>
                        <option value="Y9I">Year 9I</option>
                        <option value="Y9S">Year 9S</option>
                        <option value="Y9J">Year 9J</option>
                        <option value="Y9B">Year 9B</option>
                        <option value="Y10C">Year 10C</option>
                        <option value="Y10H">Year 10H</option>
                        <option value="Y10I">Year 10I</option>
                        <option value="Y10S">Year 10S</option>
                        <option value="Y10J">Year 10J</option>
                        <option value="Y10B">Year 10B</option>
                        <option value="Y11C">Year 11C</option>
                        <option value="Y11H">Year 11H</option>
                        <option value="Y11I">Year 11I</option>
                        <option value="Y11S">Year 11S</option>
                        <option value="Y11J">Year 11J</option>
                        <option value="Y11B">Year 11B</option>
                        <option value="Y12C">Year 12C</option>
                        <option value="Y12H">Year 12H</option>
                        <option value="Y12I">Year 12I</option>
                        <option value="Y12S">Year 12S</option>
                        <option value="Y12J">Year 12J</option>
                        <option value="Y12B">Year 12B</option>
                    </select>
                </div>
                
                <button type="submit" class="login-btn">
                    🚀 Start Learning
                </button>
            </form>
        </div>

        <!-- Main App (Hidden until login) -->
        <div id="mainApp" style="display: none;">
            <div class="header">
                <div class="header-left">
                    <h1>🏃‍♂️ PE Master</h1>
                    <p>Complete Physical Education Learning Platform</p>
                </div>
                <div class="user-info">
                    <h3 id="welcomeUser"></h3>
                    <p id="userClass"></p>
                    <p id="userProgress"></p>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>

            <!-- Progress Overview -->
            <div id="progressOverview" class="progress-stats">
                <div class="stat-card">
                    <div class="stat-number" id="quizzesCompleted">0</div>
                    <div class="stat-label">Quizzes Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="averageScore">0%</div>
                    <div class="stat-label">Average Quiz Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="lessonsCompleted">0</div>
                    <div class="stat-label">PE Lessons Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalProgress">0%</div>
                    <div class="stat-label">Overall Progress</div>
                </div>
            </div>

            <!-- Main Menu -->
            <div id="mainMenu" class="main-menu">
                <div class="menu-card" onclick="showSection('sports')">
                    <span class="menu-icon">🏀</span>
                    <h2>Sports Assessment</h2>
                    <p>Progressive skill tracking across multiple sports. Master techniques, improve performance, and track your development.</p>
                    <div class="progress-indicator">
                        <div class="progress-fill" id="sportsProgress" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="menu-card" onclick="showSection('quizzes')">
                    <span class="menu-icon">🧠</span>
                    <h2>PE Knowledge & Values</h2>
                    <p>Interactive quizzes covering sportsmanship, teamwork, body awareness, safety, and social aspects of PE.</p>
                    <div class="progress-indicator">
                        <div class="progress-fill" id="quizProgress" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Sports Section -->
            <div id="sports" class="section">
                <button class="back-btn" onclick="showMainMenu()">← Back to Main Menu</button>
                <h2>🏆 Sports Assessment & Tracking</h2>
                <p>Choose a sport to begin your progressive learning journey with structured lessons and skill assessments.</p>
                
                <div class="sports-grid">
                    <div class="sport-card" onclick="showSport('basketball')">
                        <span class="sport-icon">🏀</span>
                        <h3>Basketball</h3>
                        <p>Dribbling, shooting, passing, defense, and game strategy</p>
                        <div class="progress-indicator">
                            <div class="progress-fill" id="basketballProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="sport-card" onclick="showSport('soccer')">
                        <span class="sport-icon">⚽</span>
                        <h3>Soccer</h3>
                        <p>Ball control, passing, shooting, positioning, and tactics</p>
                        <div class="progress-indicator">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="sport-card" onclick="showSport('volleyball')">
                        <span class="sport-icon">🏐</span>
                        <h3>Volleyball</h3>
                        <p>Serving, spiking, setting, blocking, and team coordination</p>
                        <div class="progress-indicator">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="sport-card" onclick="showSport('tennis')">
                        <span class="sport-icon">🎾</span>
                        <h3>Tennis</h3>
                        <p>Forehand, backhand, serving, footwork, and match play</p>
                        <div class="progress-indicator">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="sport-card" onclick="showSport('athletics')">
                        <span class="sport-icon">🏃‍♂️</span>
                        <h3>Track & Field</h3>
                        <p>Running, jumping, throwing, technique, and performance</p>
                        <div class="progress-indicator">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="sport-card" onclick="showSport('gymnastics')">
                        <span class="sport-icon">🤸‍♀️</span>
                        <h3>Gymnastics</h3>
                        <p>Balance, flexibility, strength, coordination, and routines</p>
                        <div class="progress-indicator">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quizzes Section -->
            <div id="quizzes" class="section">
                <button class="back-btn" onclick="showMainMenu()">← Back to Main Menu</button>
                <h2>🧠 PE Knowledge & Values Quizzes</h2>
                <p>Test your understanding of physical education principles, values, and body awareness through interactive quizzes.</p>
                
                <div class="quiz-grid">
                    <div class="quiz-card" onclick="startQuiz('values')">
                        <span class="quiz-icon">🤝</span>
                        <h3>PE Values & Ethics</h3>
                        <p>Respect, fair play, teamwork, and sportsmanship</p>
                        <div class="progress-indicator">
                            <div class="progress-fill" id="valuesProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="quiz-card" onclick="startQuiz('body')">
                        <span class="quiz-icon">💪</span>
                        <h3>Body Awareness & Health</h3>
                        <p>Understanding your body, injury prevention, and wellness</p>
                        <div class="progress-indicator">
                            <div class="progress-fill" id="bodyProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="quiz-card" onclick="startQuiz('motor')">
                        <span class="quiz-icon">🎯</span>
                        <h3>Motor Skills & Movement</h3>
                        <p>Coordination, balance, agility, and movement patterns</p>
                        <div class="progress-indicator">
                            <div class="progress-fill" id="motorProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="quiz-card" onclick="startQuiz('social')">
                        <span class="quiz-icon">👥</span>
                        <h3>Social Roles in PE</h3>
                        <p>Refereeing, coaching, leadership, and communication</p>
                        <div class="progress-indicator">
                            <div class="progress-fill" id="socialProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="quiz-card" onclick="startQuiz('safety')">
                        <span class="quiz-icon">🛡️</span>
                        <h3>Safety & Responsibility</h3>
                        <p>Risk awareness, equipment care, and personal responsibility</p>
                        <div class="progress-indicator">
                            <div class="progress-fill" id="safetyProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="quiz-card" onclick="startQuiz('nutrition')">
                        <span class="quiz-icon">🥗</span>
                        <h3>Nutrition & Performance</h3>
                        <p>Healthy eating, hydration, and performance optimization</p>
                        <div class="progress-indicator">
                            <div class="progress-fill" id="nutritionProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Basketball Sport Detail -->
            <div id="basketballDetail" class="section">
                <button class="back-btn" onclick="showSection('sports')">← Back to Sports</button>
                <h2>🏀 Basketball Assessment Program</h2>
                <p>Master basketball through 10 progressive lessons with comprehensive skill tracking.</p>
                
                <div class="lesson-grid" id="basketballLessons">
                    <!-- Basketball lessons will be populated here -->
                </div>
            </div>

            <!-- Quiz Container -->
            <div id="quizContainer" class="section">
                <button class="back-btn" onclick="showSection('quizzes')">← Back to Quizzes</button>
                <div id="quizContent">
                    <!-- Quiz content will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Student data management
        let currentStudent = null;
        let studentData = {};

        // Basketball lessons data
        const basketballLessons = [
            { id: 1, title: "Basic Ball Handling", purpose: "Learn fundamental dribbling techniques and ball control" },
            { id: 2, title: "Passing Fundamentals", purpose: "Master chest pass, bounce pass, and overhead pass techniques" },
            { id: 3, title: "Shooting Basics", purpose: "Develop proper shooting form and free throw technique" },
            { id: 4, title: "Defensive Positioning", purpose: "Learn basic defensive stance and movement principles" },
            { id: 5, title: "Offensive Movement", purpose: "Understand cutting, screening, and creating space" },
            { id: 6, title: "Game Rules & Refereeing", purpose: "Learn basketball rules and practice making calls" },
            { id: 7, title: "Team Play & Strategy", purpose: "Develop teamwork skills and basic game strategies" },
            { id: 8, title: "Advanced Dribbling", purpose: "Master crossover, behind-the-back, and pressure dribbling" },
            { id: 9, title: "Game Situations", purpose: "Apply skills in realistic game scenarios and pressure situations" },
            { id: 10, title: "Mastery Assessment", purpose: "Demonstrate all skills in a comprehensive final evaluation" }
        ];

        // Quiz questions data (same as before)
        const quizData = {
            values: {
                title: "PE Values & Ethics Quiz",
                icon: "🤝",
                questions: [
                    {
                        question: "What is the most important aspect of fair play in sports?",
                        options: [
                            "Winning at all costs",
                            "Respecting opponents and rules",
                            "Being the best player",
                            "Getting the most points"
                        ],
                        correct: 1,
                        explanation: "Fair play means respecting your opponents, teammates, officials, and the rules of the game."
                    },
                    {
                        question: "How should you react when a teammate makes a mistake?",
                        options: [
                            "Criticize them loudly",
                            "Ignore them completely",
                            "Encourage and support them",
                            "Take over their position"
                        ],
                        correct: 2,
                        explanation: "Supporting teammates builds confidence and team unity, leading to better performance."
                    },
                    {
                        question: "What does good sportsmanship include?",
                        options: [
                            "Only celebrating your own success",
                            "Arguing with referees' decisions",
                            "Congratulating opponents after the game",
                            "Blaming others for losses"
                        ],
                        correct: 2,
                        explanation: "Good sportsmanship includes respecting opponents and acknowledging their efforts."
                    },
                    {
                        question: "When your team is losing, what should you do?",
                        options: [
                            "Give up and stop trying",
                            "Blame your teammates",
                            "Keep playing your best and stay positive",
                            "Argue with the referee"
                        ],
                        correct: 2,
                        explanation: "True character is shown when facing adversity. Keep trying and maintain a positive attitude."
                    },
                    {
                        question: "What is the best way to handle a disagreement with a referee's call?",
                        options: [
                            "Argue loudly until they change their mind",
                            "Accept the decision and continue playing",
                            "Ask your coach to yell at the referee",
                            "Stop playing in protest"
                        ],
                        correct: 1,
                        explanation: "Referees are human and make mistakes, but respecting their authority is part of good sportsmanship."
                    },
                    {
                        question: "How should you treat a new student who isn't very good at sports?",
                        options: [
                            "Avoid choosing them for your team",
                            "Make fun of their mistakes",
                            "Help them learn and encourage their efforts",
                            "Ignore them completely"
                        ],
                        correct: 2,
                        explanation: "Everyone deserves respect and encouragement. Helping others improves the whole team."
                    },
                    {
                        question: "What does 'playing with integrity' mean?",
                        options: [
                            "Only following rules when the referee is watching",
                            "Doing the right thing even when no one is looking",
                            "Winning by any means necessary",
                            "Only being honest when it benefits you"
                        ],
                        correct: 1,
                        explanation: "Integrity means doing what's right regardless of whether anyone is watching or keeping score."
                    },
                    {
                        question: "How should you celebrate after scoring or winning?",
                        options: [
                            "Taunt the opposing team",
                            "Show respect while enjoying your success",
                            "Brag about how much better you are",
                            "Make the other team feel bad"
                        ],
                        correct: 1,
                        explanation: "Celebrate your achievements while still showing respect for your opponents and the game."
                    }
                ]
            },
            body: {
                title: "Body Awareness & Health Quiz",
                icon: "💪",
                questions: [
                    {
                        question: "Why is warming up before exercise important?",
                        options: [
                            "It's just a tradition",
                            "To prepare muscles and prevent injury",
                            "To waste time before the real activity",
                            "Only professional athletes need it"
                        ],
                        correct: 1,
                        explanation: "Warming up increases blood flow to muscles and prepares your body for physical activity."
                    },
                    {
                        question: "What should you do if you feel pain during exercise?",
                        options: [
                            "Push through the pain",
                            "Stop and assess the situation",
                            "Ignore it completely",
                            "Exercise harder to overcome it"
                        ],
                        correct: 1,
                        explanation: "Pain is your body's warning signal. Stop and evaluate to prevent serious injury."
                    },
                    {
                        question: "How much water should you drink during physical activity?",
                        options: [
                            "Only when you feel thirsty",
                            "Small sips regularly throughout",
                            "A lot all at once",
                            "Water isn't necessary during exercise"
                        ],
                        correct: 1,
                        explanation: "Regular small amounts of water help maintain hydration without causing discomfort."
                    },
                    {
                        question: "What happens to your heart rate during exercise?",
                        options: [
                            "It stays the same",
                            "It decreases significantly",
                            "It increases to pump more blood",
                            "It stops temporarily"
                        ],
                        correct: 2,
                        explanation: "Your heart beats faster during exercise to deliver more oxygen and nutrients to working muscles."
                    },
                    {
                        question: "Why is cooling down after exercise important?",
                        options: [
                            "To show off your flexibility",
                            "To gradually return heart rate to normal",
                            "It's not really necessary",
                            "Only for older people"
                        ],
                        correct: 1,
                        explanation: "Cooling down helps your body gradually return to its resting state and prevents dizziness."
                    },
                    {
                        question: "What is the best way to improve flexibility?",
                        options: [
                            "Bouncing while stretching",
                            "Holding stretches for 15-30 seconds",
                            "Stretching only when you feel tight",
                            "Avoiding stretching completely"
                        ],
                        correct: 1,
                        explanation: "Static stretching held for 15-30 seconds safely improves flexibility over time."
                    },
                    {
                        question: "How does regular exercise affect your sleep?",
                        options: [
                            "It makes sleep worse",
                            "It has no effect on sleep",
                            "It improves sleep quality",
                            "It makes you need less sleep"
                        ],
                        correct: 2,
                        explanation: "Regular physical activity helps you fall asleep faster and enjoy deeper, more restful sleep."
                    },
                    {
                        question: "What should you wear during physical activity?",
                        options: [
                            "Whatever looks fashionable",
                            "Tight clothing that restricts movement",
                            "Comfortable, breathable clothing and proper shoes",
                            "Heavy clothing to sweat more"
                        ],
                        correct: 2,
                        explanation: "Proper clothing allows free movement, wicks away sweat, and appropriate shoes prevent injury."
                    },
                    {
                        question: "Why is it important to know your fitness level?",
                        options: [
                            "To compare yourself to others",
                            "To set appropriate goals and avoid overexertion",
                            "It's not important at all",
                            "Only for competitive athletes"
                        ],
                        correct: 1,
                        explanation: "Understanding your fitness level helps you exercise safely and set realistic improvement goals."
                    }
                ]
            },
            motor: {
                title: "Motor Skills & Movement Quiz",
                icon: "🎯",
                questions: [
                    {
                        question: "What is the key to improving balance?",
                        options: [
                            "Only practicing on flat surfaces",
                            "Avoiding challenging positions",
                            "Regular practice with varied challenges",
                            "Natural talent only"
                        ],
                        correct: 2,
                        explanation: "Balance improves through consistent practice with progressively challenging exercises."
                    },
                    {
                        question: "Which factor most affects coordination?",
                        options: [
                            "Age only",
                            "Practice and repetition",
                            "Height and weight",
                            "Natural ability only"
                        ],
                        correct: 1,
                        explanation: "Coordination develops through practice, repetition, and muscle memory."
                    },
                    {
                        question: "What helps develop agility?",
                        options: [
                            "Only running in straight lines",
                            "Direction changes and quick movements",
                            "Standing still exercises",
                            "Slow, controlled movements only"
                        ],
                        correct: 1,
                        explanation: "Agility develops through exercises involving quick direction changes and reactive movements."
                    },
                    {
                        question: "What is gross motor skill?",
                        options: [
                            "Skills using small muscle groups",
                            "Skills using large muscle groups",
                            "Skills that are disgusting",
                            "Skills only for adults"
                        ],
                        correct: 1,
                        explanation: "Gross motor skills involve large muscle groups for activities like running, jumping, and throwing."
                    },
                    {
                        question: "Which is an example of fine motor skill in PE?",
                        options: [
                            "Running a marathon",
                            "Gripping a tennis racket properly",
                            "Jumping over a hurdle",
                            "Swimming across a pool"
                        ],
                        correct: 1,
                        explanation: "Fine motor skills involve precise movements of small muscles, like proper grip and finger control."
                    },
                    {
                        question: "What does 'spatial awareness' mean in movement?",
                        options: [
                            "Knowing about outer space",
                            "Understanding where your body is in relation to objects and people",
                            "Being aware of time",
                            "Knowing the rules of sports"
                        ],
                        correct: 1,
                        explanation: "Spatial awareness helps you move safely and effectively by understanding your position relative to your environment."
                    },
                    {
                        question: "How can you improve reaction time?",
                        options: [
                            "Sleeping more",
                            "Practicing quick response activities",
                            "Eating more food",
                            "Avoiding all physical activity"
                        ],
                        correct: 1,
                        explanation: "Reaction time improves through practice with activities that require quick responses to stimuli."
                    },
                    {
                        question: "What is bilateral coordination?",
                        options: [
                            "Using only one side of your body",
                            "Using both sides of your body together",
                            "Coordinating with a partner",
                            "Moving very slowly"
                        ],
                        correct: 1,
                        explanation: "Bilateral coordination involves using both sides of your body together effectively, like swimming or jumping jacks."
                    },
                    {
                        question: "Why is rhythm important in movement?",
                        options: [
                            "It's only important for dancing",
                            "It helps create smooth, efficient movements",
                            "It's not important at all",
                            "Only musicians need rhythm"
                        ],
                        correct: 1,
                        explanation: "Rhythm helps create smooth, coordinated movements and improves overall motor performance."
                    }
                ]
            },
            social: {
                title: "Social Roles in PE Quiz",
                icon: "👥",
                questions: [
                    {
                        question: "What is the most important quality of a good referee?",
                        options: [
                            "Favoring the home team",
                            "Being fair and consistent",
                            "Making popular decisions",
                            "Avoiding difficult calls"
                        ],
                        correct: 1,
                        explanation: "Good referees apply rules fairly and consistently for all players and teams."
                    },
                    {
                        question: "How can you be a good team captain?",
                        options: [
                            "Making all decisions alone",
                            "Only talking to the best players",
                            "Communicating and encouraging everyone",
                            "Focusing only on winning"
                        ],
                        correct: 2,
                        explanation: "Good captains communicate effectively and encourage all team members to participate."
                    },
                    {
                        question: "What makes coaching effective?",
                        options: [
                            "Criticizing mistakes harshly",
                            "Only working with talented players",
                            "Providing clear, positive feedback",
                            "Focusing only on winning games"
                        ],
                        correct: 2,
                        explanation: "Effective coaching involves clear communication, positive reinforcement, and skill development."
                    },
                    {
                        question: "What should you do when acting as a scorekeeper?",
                        options: [
                            "Favor your favorite team",
                            "Keep accurate, honest records",
                            "Change scores to make games closer",
                            "Only count points for the winning team"
                        ],
                        correct: 1,
                        explanation: "Scorekeepers must maintain accurate, unbiased records for fair play and game integrity."
                    },
                    {
                        question: "How should you communicate during team activities?",
                        options: [
                            "Only speak when you have the ball",
                            "Yell at teammates when they make mistakes",
                            "Use positive, clear communication",
                            "Stay silent to avoid distracting others"
                        ],
                        correct: 2,
                        explanation: "Positive, clear communication helps coordinate team efforts and builds confidence."
                    },
                    {
                        question: "What is the role of a team manager?",
                        options: [
                            "To play in every game",
                            "To organize equipment and support the team",
                            "To argue with referees",
                            "To choose who plays and who doesn't"
                        ],
                        correct: 1,
                        explanation: "Team managers help organize logistics, equipment, and provide valuable support to players and coaches."
                    },
                    {
                        question: "How should you handle peer pressure in PE?",
                        options: [
                            "Always do what others want",
                            "Make decisions based on safety and values",
                            "Avoid participating in activities",
                            "Only follow pressure from popular students"
                        ],
                        correct: 1,
                        explanation: "Make decisions based on what's safe, right, and aligns with your values, not just peer pressure."
                    },
                    {
                        question: "What makes a good teammate?",
                        options: [
                            "Being the most skilled player",
                            "Supporting others and working together",
                            "Taking all the credit for wins",
                            "Only helping friends"
                        ],
                        correct: 1,
                        explanation: "Good teammates support everyone, share credit, and work together toward common goals."
                    },
                    {
                        question: "How should you resolve conflicts during PE activities?",
                        options: [
                            "Fight it out physically",
                            "Ignore the problem completely",
                            "Communicate calmly and seek solutions",
                            "Get revenge later"
                        ],
                        correct: 2,
                        explanation: "Calm communication and problem-solving create better outcomes than conflict or avoidance."
                    }
                ]
            },
            safety: {
                title: "Safety & Responsibility Quiz",
                icon: "🛡️",
                questions: [
                    {
                        question: "Before using sports equipment, you should:",
                        options: [
                            "Use it immediately",
                            "Check for damage or wear",
                            "Assume it's always safe",
                            "Let someone else check it"
                        ],
                        correct: 1,
                        explanation: "Always inspect equipment for damage before use to prevent injuries."
                    },
                    {
                        question: "What should you do if you see unsafe behavior during PE?",
                        options: [
                            "Ignore it if it's not affecting you",
                            "Join in with the behavior",
                            "Report it to the teacher immediately",
                            "Handle it yourself"
                        ],
                        correct: 2,
                        explanation: "Unsafe behavior should be reported to prevent injuries to yourself and others."
                    },
                    {
                        question: "Who is responsible for your safety during PE?",
                        options: [
                            "Only the teacher",
                            "Only yourself",
                            "Everyone participating",
                            "Only the school"
                        ],
                        correct: 2,
                        explanation: "Safety is everyone's responsibility - teachers, students, and the school all play a part."
                    },
                    {
                        question: "What should you do if someone gets injured during PE?",
                        options: [
                            "Move them immediately",
                            "Give them water and tell them to walk it off",
                            "Stop activity and get the teacher immediately",
                            "Continue playing around them"
                        ],
                        correct: 2,
                        explanation: "Stop all activity and get trained help immediately. Don't move injured people unless you're trained."
                    },
                    {
                        question: "Why is it important to follow safety rules even in fun activities?",
                        options: [
                            "Rules are meant to be broken",
                            "Safety rules prevent injuries and keep activities enjoyable",
                            "Rules only apply to serious sports",
                            "Safety rules slow down the fun"
                        ],
                        correct: 1,
                        explanation: "Safety rules ensure everyone can participate and enjoy activities without getting hurt."
                    },
                    {
                        question: "What should you wear for outdoor PE activities in sunny weather?",
                        options: [
                            "Dark, heavy clothing",
                            "Sunscreen and appropriate clothing",
                            "No protection needed",
                            "Only a hat"
                        ],
                        correct: 1,
                        explanation: "Sun protection including sunscreen, appropriate clothing, and hats prevent sunburn and heat illness."
                    },
                    {
                        question: "How should you handle equipment after using it?",
                        options: [
                            "Leave it where you used it",
                            "Put it away properly and report any damage",
                            "Hide any damage you caused",
                            "Let someone else clean up"
                        ],
                        correct: 1,
                        explanation: "Proper equipment care ensures it's safe for the next person and lasts longer."
                    },
                    {
                        question: "What's the most important thing about emergency procedures?",
                        options: [
                            "Memorizing every detail",
                            "Knowing where to find help and how to get it",
                            "Being able to treat all injuries yourself",
                            "Ignoring emergencies"
                        ],
                        correct: 1,
                        explanation: "Knowing how to quickly get appropriate help is the most important emergency skill."
                    },
                    {
                        question: "Why should you never participate in PE activities under the influence of substances?",
                        options: [
                            "It's against school rules only",
                            "It impairs judgment and increases injury risk",
                            "It's only dangerous for certain activities",
                            "It doesn't really matter"
                        ],
                        correct: 1,
                        explanation: "Substances impair coordination, judgment, and reaction time, greatly increasing injury risk."
                    }
                ]
            },
            nutrition: {
                title: "Nutrition & Performance Quiz",
                icon: "🥗",
                questions: [
                    {
                        question: "When is the best time to eat before exercise?",
                        options: [
                            "Right before starting",
                            "1-3 hours before",
                            "During the exercise",
                            "It doesn't matter"
                        ],
                        correct: 1,
                        explanation: "Eating 1-3 hours before exercise gives your body time to digest and provides energy."
                    },
                    {
                        question: "What type of foods provide quick energy for sports?",
                        options: [
                            "Fatty foods",
                            "Protein-rich foods",
                            "Carbohydrates",
                            "Sugary snacks only"
                        ],
                        correct: 2,
                        explanation: "Carbohydrates are the body's preferred source of quick energy for physical activity."
                    },
                    {
                        question: "Why is hydration important during exercise?",
                        options: [
                            "It's not really important",
                            "To regulate body temperature and maintain performance",
                            "Only for appearance",
                            "Only in hot weather"
                        ],
                        correct: 1,
                        explanation: "Proper hydration helps regulate body temperature and maintains physical and mental performance."
                    },
                    {
                        question: "What should you eat after exercise for recovery?",
                        options: [
                            "Only protein",
                            "Only carbohydrates",
                            "A combination of protein and carbohydrates",
                            "Nothing for several hours"
                        ],
                        correct: 2,
                        explanation: "Combining protein and carbohydrates after exercise helps muscle recovery and energy replenishment."
                    },
                    {
                        question: "How much water should you drink daily?",
                        options: [
                            "Only when thirsty",
                            "About 8 glasses (64 ounces) or more",
                            "As little as possible",
                            "Only during meals"
                        ],
                        correct: 1,
                        explanation: "About 8 glasses of water daily helps maintain proper hydration, more if you're active."
                    },
                    {
                        question: "Which foods should you avoid right before physical activity?",
                        options: [
                            "Fruits and vegetables",
                            "High-fat and high-fiber foods",
                            "Water",
                            "Whole grains"
                        ],
                        correct: 1,
                        explanation: "High-fat and high-fiber foods take more energy to digest and can cause discomfort during exercise."
                    },
                    {
                        question: "What role does protein play in athletic performance?",
                        options: [
                            "Provides immediate energy",
                            "Builds and repairs muscles",
                            "Replaces lost fluids",
                            "Has no role in athletics"
                        ],
                        correct: 1,
                        explanation: "Protein is essential for building and repairing muscle tissue, especially after exercise."
                    },
                    {
                        question: "Why are vitamins and minerals important for athletes?",
                        options: [
                            "They provide energy directly",
                            "They help body processes work efficiently",
                            "They replace water",
                            "They're not important for athletes"
                        ],
                        correct: 1,
                        explanation: "Vitamins and minerals support energy production, muscle function, and recovery processes."
                    },
                    {
                        question: "What's the best approach to sports nutrition?",
                        options: [
                            "Eat whatever you want",
                            "Take lots of supplements",
                            "Eat a balanced, varied diet",
                            "Avoid all fats and carbohydrates"
                        ],
                        correct: 2,
                        explanation: "A balanced, varied diet with appropriate timing provides the best nutrition for athletic performance."
                    },
                    {
                        question: "How does poor nutrition affect athletic performance?",
                        options: [
                            "It has no effect",
                            "It only affects professional athletes",
                            "It reduces energy, strength, and recovery",
                            "It only affects appearance"
                        ],
                        correct: 2,
                        explanation: "Poor nutrition leads to decreased energy, reduced strength, slower recovery, and increased injury risk."
                    }
                ]
            }
        };

        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedAnswers = [];

        // Login and student management functions
        function handleLogin(event) {
            event.preventDefault();
            
            const name = document.getElementById('studentName').value.trim();
            const id = document.getElementById('studentId').value.trim();
            const className = document.getElementById('studentClass').value;
            
            if (!name || !id || !className) {
                alert('Please fill in all fields to continue.');
                return;
            }
            
            // Create student profile
            currentStudent = {
                name: name,
                id: id,
                class: className,
                loginTime: new Date().toISOString()
            };
            
            // Load or create student data
            const studentKey = `student_${id}_${className}`;
            const savedData = localStorage.getItem(studentKey);
            
            if (savedData) {
                try {
                    studentData = JSON.parse(savedData);
                    // Ensure all required fields exist (for backwards compatibility)
                    if (!studentData.quizzes) studentData.quizzes = {};
                    if (!studentData.sports) studentData.sports = {};
                    if (!studentData.sports.basketball) studentData.sports.basketball = { lessons: [] };
                    
                    // Initialize missing quiz data
                    const quizTypes = ['values', 'body', 'motor', 'social', 'safety', 'nutrition'];
                    quizTypes.forEach(type => {
                        if (!studentData.quizzes[type]) {
                            studentData.quizzes[type] = { 
                                completed: false, 
                                score: 0, 
                                attempts: 0, 
                                bestScore: 0,
                                completionDate: null,
                                timeSpent: 0
                            };
                        }
                    });
                    
                    // Initialize missing basketball lessons
                    if (studentData.sports.basketball.lessons.length === 0) {
                        studentData.sports.basketball.lessons = basketballLessons.map(lesson => ({
                            ...lesson,
                            completed: false,
                            progress: 0,
                            lastAccessed: null,
                            timeSpent: 0,
                            completionDate: null
                        }));
                    }
                    
                    // Update session count
                    studentData.totalSessions = (studentData.totalSessions || 0) + 1;
                    
                } catch (error) {
                    console.error('Error loading student data:', error);
                    // Create fresh data if corrupted
                    studentData = createFreshStudentData(currentStudent);
                }
            } else {
                // Initialize new student data
                studentData = createFreshStudentData(currentStudent);
            }
            
            // Update login info
            studentData.profile = currentStudent;
            studentData.lastLogin = new Date().toISOString();
            
            // Save data immediately
            saveStudentData();
            
            // Show main app
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            updateUserInterface();
            updateProgressDisplay();
            showMainMenu();
            
            // Auto-save every 30 seconds
            startAutoSave();
        }

        function createFreshStudentData(student) {
            return {
                profile: student,
                quizzes: {
                    values: { completed: false, score: 0, attempts: 0, bestScore: 0, completionDate: null, timeSpent: 0 },
                    body: { completed: false, score: 0, attempts: 0, bestScore: 0, completionDate: null, timeSpent: 0 },
                    motor: { completed: false, score: 0, attempts: 0, bestScore: 0, completionDate: null, timeSpent: 0 },
                    social: { completed: false, score: 0, attempts: 0, bestScore: 0, completionDate: null, timeSpent: 0 },
                    safety: { completed: false, score: 0, attempts: 0, bestScore: 0, completionDate: null, timeSpent: 0 },
                    nutrition: { completed: false, score: 0, attempts: 0, bestScore: 0, completionDate: null, timeSpent: 0 }
                },
                sports: {
                    basketball: {
                        lessons: basketballLessons.map(lesson => ({
                            ...lesson,
                            completed: false,
                            progress: 0,
                            lastAccessed: null,
                            timeSpent: 0,
                            completionDate: null
                        }))
                    }
                },
                totalSessions: 1,
                totalTimeSpent: 0,
                lastLogin: new Date().toISOString(),
                createdDate: new Date().toISOString()
            };
        }

        function logout() {
            // Save final data
            saveStudentData();
            
            // Stop auto-save
            stopAutoSave();
            
            // Reset state
            currentStudent = null;
            studentData = {};
            
            // Show login screen
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            
            // Clear form
            document.getElementById('studentName').value = '';
            document.getElementById('studentId').value = '';
            document.getElementById('studentClass').value = '';
        }

        function updateUserInterface() {
            if (!currentStudent) return;
            
            document.getElementById('welcomeUser').textContent = `Welcome, ${currentStudent.name}!`;
            document.getElementById('userClass').textContent = `Class: ${currentStudent.class}`;
            
            // Calculate total sessions
            const sessions = studentData.totalSessions || 1;
            document.getElementById('userProgress').textContent = `Session #${sessions}`;
        }

        function updateProgressDisplay() {
            if (!studentData) return;
            
            // Calculate quiz statistics
            const quizzes = studentData.quizzes;
            const quizTypes = Object.keys(quizzes);
            let completedQuizzes = 0;
            let totalScore = 0;
            let totalAttempts = 0;
            
            quizTypes.forEach(type => {
                if (quizzes[type].completed) {
                    completedQuizzes++;
                    totalScore += quizzes[type].bestScore;
                }
                totalAttempts += quizzes[type].attempts;
            });
            
            const averageScore = completedQuizzes > 0 ? Math.round(totalScore / completedQuizzes) : 0;
            
            // Calculate lesson progress
            const basketballLessons = studentData.sports.basketball.lessons;
            const completedLessons = basketballLessons.filter(lesson => lesson.completed).length;
            
            // Calculate overall progress
            const quizProgress = (completedQuizzes / quizTypes.length) * 50; // 50% weight for quizzes
            const lessonProgress = (completedLessons / basketballLessons.length) * 50; // 50% weight for lessons
            const totalProgress = Math.round(quizProgress + lessonProgress);
            
            // Update display
            document.getElementById('quizzesCompleted').textContent = completedQuizzes;
            document.getElementById('averageScore').textContent = `${averageScore}%`;
            document.getElementById('lessonsCompleted').textContent = completedLessons;
            document.getElementById('totalProgress').textContent = `${totalProgress}%`;
            
            // Update progress bars
            document.getElementById('sportsProgress').style.width = `${(completedLessons / basketballLessons.length) * 100}%`;
            document.getElementById('quizProgress').style.width = `${(completedQuizzes / quizTypes.length) * 100}%`;
            document.getElementById('basketballProgress').style.width = `${(completedLessons / basketballLessons.length) * 100}%`;
            
            // Update individual quiz progress bars
            quizTypes.forEach(type => {
                const element = document.getElementById(`${type}Progress`);
                if (element) {
                    const progress = quizzes[type].completed ? 100 : (quizzes[type].attempts > 0 ? 50 : 0);
                    element.style.width = `${progress}%`;
                }
            });
        }

        let autoSaveInterval = null;
        let sessionStartTime = null;

        function saveStudentData() {
            if (currentStudent && studentData) {
                try {
                    // Update total time spent if session is active
                    if (sessionStartTime) {
                        const sessionTime = Date.now() - sessionStartTime;
                        studentData.totalTimeSpent = (studentData.totalTimeSpent || 0) + sessionTime;
                        sessionStartTime = Date.now(); // Reset for next interval
                    }
                    
                    const studentKey = `student_${currentStudent.id}_${currentStudent.class}`;
                    const dataToSave = {
                        ...studentData,
                        lastSaved: new Date().toISOString()
                    };
                    
                    localStorage.setItem(studentKey, JSON.stringify(dataToSave));
                    
                    // Also save to a master list for teacher access
                    const masterKey = 'pe_master_student_list';
                    let masterList = [];
                    try {
                        const existingList = localStorage.getItem(masterKey);
                        if (existingList) {
                            masterList = JSON.parse(existingList);
                        }
                    } catch (e) {
                        console.warn('Could not load master list');
                    }
                    
                    // Update or add student to master list
                    const existingIndex = masterList.findIndex(s => 
                        s.id === currentStudent.id && s.class === currentStudent.class
                    );
                    
                    const studentSummary = {
                        id: currentStudent.id,
                        name: currentStudent.name,
                        class: currentStudent.class,
                        lastLogin: studentData.lastLogin,
                        totalSessions: studentData.totalSessions,
                        totalTimeSpent: studentData.totalTimeSpent,
                        quizzesCompleted: Object.values(studentData.quizzes).filter(q => q.completed).length,
                        averageScore: calculateAverageScore(),
                        lessonsCompleted: studentData.sports.basketball.lessons.filter(l => l.completed).length
                    };
                    
                    if (existingIndex >= 0) {
                        masterList[existingIndex] = studentSummary;
                    } else {
                        masterList.push(studentSummary);
                    }
                    
                    localStorage.setItem(masterKey, JSON.stringify(masterList));
                    
                } catch (error) {
                    console.error('Error saving student data:', error);
                    alert('Warning: Your progress may not be saved properly. Please contact your teacher if this continues.');
                }
            }
        }

        function calculateAverageScore() {
            const completedQuizzes = Object.values(studentData.quizzes).filter(q => q.completed);
            if (completedQuizzes.length === 0) return 0;
            
            const totalScore = completedQuizzes.reduce((sum, quiz) => sum + quiz.bestScore, 0);
            return Math.round(totalScore / completedQuizzes.length);
        }

        function startAutoSave() {
            // Clear any existing auto-save
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            
            // Start session timer
            sessionStartTime = Date.now();
            
            // Auto-save every 30 seconds
            autoSaveInterval = setInterval(() => {
                saveStudentData();
            }, 30000);
            
            // Save when page is about to close
            window.addEventListener('beforeunload', () => {
                saveStudentData();
            });
        }

        function stopAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
                autoSaveInterval = null;
            }
            sessionStartTime = null;
        }

        function showMainMenu() {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('mainMenu').style.display = 'grid';
        }

        function showSection(sectionName) {
            document.getElementById('mainMenu').style.display = 'none';
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName).classList.add('active');
        }

        function showSport(sportName) {
            if (sportName === 'basketball') {
                showSection('sports');
                document.getElementById('basketballDetail').classList.add('active');
                renderBasketballLessons();
            } else {
                alert(`${sportName.charAt(0).toUpperCase() + sportName.slice(1)} assessment program coming soon! 🚀\n\nThis will include progressive lessons similar to basketball, tailored for ${sportName} skills and techniques.`);
            }
        }

        function renderBasketballLessons() {
            const container = document.getElementById('basketballLessons');
            const lessons = studentData.sports.basketball.lessons;
            
            container.innerHTML = lessons.map(lesson => {
                let cardClass = 'lesson-card';
                let statusText = 'Not Started';
                
                if (lesson.completed) {
                    cardClass += ' completed';
                    statusText = 'Completed ✓';
                } else if (lesson.progress > 0) {
                    cardClass += ' in-progress';
                    statusText = `${lesson.progress}% Complete`;
                }
                
                return `
                    <div class="${cardClass}" onclick="accessLesson(${lesson.id})">
                        <h3>Lesson ${lesson.id}: ${lesson.title}</h3>
                        <p>${lesson.purpose}</p>
                        <div class="progress-indicator">
                            <div class="progress-fill" style="width: ${lesson.progress}%"></div>
                        </div>
                        <small style="opacity: 0.9; margin-top: 10px; display: block;">
                            ${statusText}
                        </small>
                    </div>
                `;
            }).join('');
        }

        function accessLesson(lessonId) {
            const lesson = studentData.sports.basketball.lessons.find(l => l.id === lessonId);
            const wasCompleted = lesson.completed;
            
            // Update last accessed time
            lesson.lastAccessed = new Date().toISOString();
            
            // Simulate lesson progress (in real app, this would be based on actual completion)
            if (!lesson.completed) {
                lesson.progress = Math.min(lesson.progress + 20, 100);
                lesson.timeSpent += 300000; // Add 5 minutes of practice time
                
                if (lesson.progress >= 100) {
                    lesson.completed = true;
                    lesson.completionDate = new Date().toISOString();
                }
            } else {
                // Add practice time even for completed lessons
                lesson.timeSpent += 180000; // Add 3 minutes for review
            }
            
            saveStudentData();
            updateProgressDisplay();
            renderBasketballLessons();
            
            // Format time spent
            const totalMinutes = Math.floor(lesson.timeSpent / 60000);
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            const timeDisplay = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
            
            let message = `Lesson ${lesson.id}: ${lesson.title}\n\n${lesson.purpose}\n\nProgress: ${lesson.progress}%\nPractice Time: ${timeDisplay}`;
            
            if (!wasCompleted && lesson.completed) {
                message += '\n\n🎉 Congratulations! You completed this lesson for the first time!';
            } else if (lesson.completed) {
                message += '\n\n✅ Lesson completed! Great review session!';
            } else {
                message += '\n\n⏳ Keep practicing to complete this lesson!';
            }
            
            alert(message);
        }

        function startQuiz(quizType) {
            currentQuiz = quizData[quizType];
            currentQuestionIndex = 0;
            score = 0;
            selectedAnswers = [];
            quizStartTime = Date.now(); // Start timing the quiz
            
            // Update quiz attempts
            studentData.quizzes[quizType].attempts++;
            
            // Hide all sections and show only quiz container
            document.getElementById('mainMenu').style.display = 'none';
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('quizContainer').classList.add('active');
            showQuizIntroduction(quizType);
        }

        function showQuizIntroduction(quizType) {
            const introData = {
                values: {
                    title: "Understanding Values & Ethics in Sports",
                    quote: "\"The man of wisdom is never of two minds; the man of benevolence never worries; the man of courage is never afraid.\"",
                    author: "- Confucius",
                    psychology: "Research in sports psychology shows that athletes who practice good sportsmanship and ethical behavior perform better under pressure and maintain longer, more successful careers. When we treat others with respect and play fairly, we build mental resilience and self-confidence that extends far beyond sports.",
                    connection: "In PE, learning values like respect, fairness, and teamwork creates a foundation for success in all areas of life. These values help us handle both victory and defeat with grace, making us stronger individuals and better teammates."
                },
                body: {
                    title: "Body Awareness & Health Connection",
                    quote: "\"He who knows that enough is enough will always have enough.\"",
                    author: "- Lao Tzu",
                    psychology: "Body awareness is the foundation of all physical learning. When we understand how our body responds to exercise, we can make smarter decisions about training, recovery, and health. This self-knowledge prevents injuries and helps us achieve our personal best.",
                    connection: "Understanding your body's signals - like heart rate, fatigue, and flexibility - allows you to exercise safely and effectively. This awareness builds confidence and helps you set realistic, achievable fitness goals."
                },
                motor: {
                    title: "Motor Skills & Movement Mastery",
                    quote: "\"I am not afraid of a person who has practiced 10,000 kicks once, but I fear a person who has practiced one kick 10,000 times.\"",
                    author: "- Bruce Lee",
                    psychology: "Motor learning research shows that consistent practice creates neural pathways in our brain that make movements automatic and efficient. Each time we repeat a skill correctly, we strengthen these pathways, making the movement smoother and more natural.",
                    connection: "In PE, developing motor skills like balance, coordination, and agility gives you the tools to learn any sport or physical activity. These fundamental skills transfer to everything from riding a bike to playing complex team sports."
                },
                social: {
                    title: "Social Skills & Leadership in PE",
                    quote: "\"A leader is best when people barely know he exists, when his work is done, his aim fulfilled, they will say: we did it ourselves.\"",
                    author: "- Lao Tzu",
                    psychology: "Social learning theory shows that we learn best in supportive environments where everyone feels valued. When students take on leadership roles like captain, referee, or coach, they develop empathy, communication skills, and confidence that benefit them throughout life.",
                    connection: "PE provides unique opportunities to practice leadership and teamwork in real situations. Whether you're encouraging a teammate or making fair calls as a referee, these experiences build social skills that help in school, work, and relationships."
                },
                safety: {
                    title: "Safety & Personal Responsibility",
                    quote: "\"Better to be safe than sorry.\"",
                    author: "- English Proverb",
                    psychology: "Taking responsibility for safety develops what psychologists call 'internal locus of control' - the belief that our actions influence outcomes. This mindset leads to better decision-making, increased self-confidence, and greater success in all areas of life.",
                    connection: "Learning to identify risks, use equipment properly, and look out for others creates habits that keep you safe in sports and daily life. This responsibility builds trust with teammates and coaches, making you a valued team member."
                },
                nutrition: {
                    title: "Nutrition & Performance Optimization",
                    quote: "\"Let food be thy medicine and medicine be thy food.\"",
                    author: "- Hippocrates",
                    psychology: "Nutritional psychology research shows that what we eat directly affects our mood, energy, and cognitive function. Athletes who understand nutrition make better food choices, leading to improved performance, faster recovery, and better overall health.",
                    connection: "Understanding how food fuels your body helps you make smart choices that improve your PE performance and daily energy levels. Good nutrition habits developed in youth often continue throughout life, promoting long-term health and wellness."
                }
            };

            const intro = introData[quizType];
            const quizStats = studentData.quizzes[quizType];
            
            document.getElementById('quizContent').innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <span style="font-size: 4em;">${currentQuiz.icon}</span>
                    <h2>${intro.title}</h2>
                    ${quizStats.attempts > 0 ? `<p style="color: #666;">Attempt #${quizStats.attempts} ${quizStats.bestScore > 0 ? `• Best Score: ${quizStats.bestScore}%` : ''}</p>` : ''}
                </div>
                
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 25px;">
                    <div style="font-size: 1.3em; font-style: italic; margin-bottom: 15px; line-height: 1.6;">
                        ${intro.quote}
                    </div>
                    <div style="text-align: right; font-weight: 600; opacity: 0.9;">
                        ${intro.author}
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 25px;">
                    <h3 style="color: #333; margin-bottom: 15px;">🧠 The Psychology Behind It</h3>
                    <p style="line-height: 1.6; color: #555; margin-bottom: 20px;">
                        ${intro.psychology}
                    </p>
                    
                    <h3 style="color: #333; margin-bottom: 15px;">🔗 Connection to PE</h3>
                    <p style="line-height: 1.6; color: #555; margin: 0;">
                        ${intro.connection}
                    </p>
                </div>
                
                <div style="text-align: center;">
                    <button class="btn btn-primary" onclick="renderQuiz()" style="font-size: 1.1em; padding: 20px 40px;">
                        Begin ${currentQuiz.title} 🚀
                    </button>
                </div>
            `;
        }

        function renderQuiz() {
            const container = document.getElementById('quizContent');
            
            if (currentQuestionIndex < currentQuiz.questions.length) {
                const question = currentQuiz.questions[currentQuestionIndex];
                container.innerHTML = `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <span style="font-size: 3em;">${currentQuiz.icon}</span>
                        <h2>${currentQuiz.title}</h2>
                        <p>Question ${currentQuestionIndex + 1} of ${currentQuiz.questions.length}</p>
                    </div>
                    
                    <div class="quiz-container">
                        <div class="question">
                            <h4>${question.question}</h4>
                            <div class="options" id="options">
                                ${question.options.map((option, index) => `
                                    <div class="option" onclick="selectOption(${index})" id="option${index}">
                                        ${option}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn btn-primary" onclick="submitAnswer()" id="submitBtn" disabled>
                                Submit Answer
                            </button>
                        </div>
                        
                        <div id="explanation" style="display: none; margin-top: 20px; padding: 20px; background: #e3f2fd; border-radius: 10px;">
                            <h4>Explanation:</h4>
                            <p id="explanationText"></p>
                            <button class="btn" onclick="nextQuestion()">
                                ${currentQuestionIndex < currentQuiz.questions.length - 1 ? 'Next Question' : 'See Results'} →
                            </button>
                        </div>
                    </div>
                `;
            } else {
                showQuizResults();
            }
        }

        function selectOption(optionIndex) {
            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.getElementById(`option${optionIndex}`).classList.add('selected');
            document.getElementById('submitBtn').disabled = false;
            selectedAnswers[currentQuestionIndex] = optionIndex;
        }

        function submitAnswer() {
            const question = currentQuiz.questions[currentQuestionIndex];
            const selectedOption = selectedAnswers[currentQuestionIndex];
            
            document.querySelectorAll('.option').forEach((option, index) => {
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === selectedOption && index !== question.correct) {
                    option.classList.add('incorrect');
                }
            });
            
            if (selectedOption === question.correct) {
                score++;
            }
            
            document.getElementById('explanation').style.display = 'block';
            document.getElementById('explanationText').textContent = question.explanation;
            document.getElementById('submitBtn').style.display = 'none';
        }

        function nextQuestion() {
            currentQuestionIndex++;
            renderQuiz();
        }

        let quizStartTime = null;

        function showQuizResults() {
            const percentage = Math.round((score / currentQuiz.questions.length) * 100);
            let message = '';
            let color = '';
            
            if (percentage >= 90) {
                message = 'Excellent! You have mastered this topic! 🏆';
                color = '#28a745';
            } else if (percentage >= 70) {
                message = 'Great job! You have a good understanding! 👍';
                color = '#17a2b8';
            } else if (percentage >= 50) {
                message = 'Good effort! Review the topics and try again! 📚';
                color = '#ffc107';
            } else {
                message = 'Keep studying! Practice makes perfect! 💪';
                color = '#dc3545';
            }
            
            // Calculate time spent on quiz
            const timeSpent = quizStartTime ? Date.now() - quizStartTime : 0;
            
            // Update student data
            const quizType = Object.keys(quizData).find(key => quizData[key] === currentQuiz);
            const wasCompleted = studentData.quizzes[quizType].completed;
            
            studentData.quizzes[quizType].score = percentage;
            studentData.quizzes[quizType].completed = percentage >= 70; // 70% to pass
            studentData.quizzes[quizType].bestScore = Math.max(studentData.quizzes[quizType].bestScore, percentage);
            studentData.quizzes[quizType].timeSpent += timeSpent;
            
            // Set completion date if first time completing
            if (!wasCompleted && percentage >= 70) {
                studentData.quizzes[quizType].completionDate = new Date().toISOString();
            }
            
            saveStudentData();
            updateProgressDisplay();
            
            // Format time spent
            const minutes = Math.floor(timeSpent / 60000);
            const seconds = Math.floor((timeSpent % 60000) / 1000);
            const timeDisplay = minutes > 0 ? `${minutes}m ${seconds}s` : `${seconds}s`;
            
            document.getElementById('quizContent').innerHTML = `
                <div style="text-align: center;">
                    <span style="font-size: 4em;">${currentQuiz.icon}</span>
                    <h2>${currentQuiz.title} - Results</h2>
                    
                    <div class="score-display" style="background: ${color};">
                        <h3>Your Score</h3>
                        <div class="score-number">${score}/${currentQuiz.questions.length}</div>
                        <p style="font-size: 1.5em; margin: 0;">${percentage}%</p>
                        <p style="margin: 15px 0 0 0;">${message}</p>
                        ${studentData.quizzes[quizType].bestScore > percentage ? `<p style="margin: 10px 0 0 0; opacity: 0.9;">Personal Best: ${studentData.quizzes[quizType].bestScore}%</p>` : ''}
                        ${!wasCompleted && percentage >= 70 ? `<p style="margin: 10px 0 0 0; opacity: 0.9;">🎉 First time completed!</p>` : ''}
                        <p style="margin: 10px 0 0 0; opacity: 0.8; font-size: 0.9em;">Time: ${timeDisplay}</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin: 20px 0; text-align: left;">
                        <h4 style="margin: 0 0 15px 0; color: #333;">📊 Your Progress Summary</h4>
                        <p style="margin: 5px 0; color: #666;">
                            <strong>Attempts:</strong> ${studentData.quizzes[quizType].attempts}
                        </p>
                        <p style="margin: 5px 0; color: #666;">
                            <strong>Best Score:</strong> ${studentData.quizzes[quizType].bestScore}%
                        </p>
                        <p style="margin: 5px 0; color: #666;">
                            <strong>Status:</strong> ${studentData.quizzes[quizType].completed ? '✅ Completed' : '⏳ In Progress'}
                        </p>
                        ${studentData.quizzes[quizType].completionDate ? `
                            <p style="margin: 5px 0; color: #666;">
                                <strong>Completed:</strong> ${new Date(studentData.quizzes[quizType].completionDate).toLocaleDateString()}
                            </p>
                        ` : ''}
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn" onclick="startQuiz('${quizType}')">
                            🔄 Retake Quiz
                        </button>
                        <button class="btn btn-primary" onclick="showSection('quizzes')">
                            📚 Choose Another Quiz
                        </button>
                    </div>
                </div>
            `;
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Show login screen by default
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9871f4480637d4a9',t:'MTc1OTIxNjc5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

